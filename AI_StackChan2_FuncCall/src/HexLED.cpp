#include "HexLED.h"
#include <math.h>

CRGB leds[NUM_LEDS];

#define C0 (CRGB::Black)
#define C1 (CRGB::Blue)
#define C2 (CRGB::Green)
#define C3 (CRGB::DarkOrange)
#define C4 (CRGB::Red)

const CRGB led_pattern00[NUM_LEDS] = {
         C0,C0,C0,C0,
       C0,C0,C0,C0,C0,
      C0,C0,C0,C0,C0,C0,
    C0,C0,C0,C0,C0,C0,C0,
      C0,C0,C0,C0,C0,C0,
       C0,C0,C0,C0,C0,
         C0,C0,C0,C0
};

const CRGB led_pattern01[NUM_LEDS] = {
         C1,C2,C1,C2,
       C2,C0,C0,C0,C1,
      C1,C0,C0,C0,C0,C2,
    C2,C0,C0,C0,C0,C0,C1,
      C1,C0,C0,C0,C0,C2,
       C2,C0,C0,C0,C1,
         C1,C2,C1,C2
};

const CRGB led_pattern02[NUM_LEDS] = {
         C2,C1,C2,C1,
       C1,C0,C0,C0,C2,
      C2,C0,C0,C0,C0,C1,
    C1,C0,C0,C0,C0,C0,C2,
      C2,C0,C0,C0,C0,C1,
       C1,C0,C0,C0,C2,
         C2,C1,C2,C1
};

const CRGB led_pattern03[NUM_LEDS] = {
         C3,C3,C3,C3,
       C3,C0,C0,C0,C3,
      C3,C0,C0,C0,C0,C3,
    C3,C0,C0,C0,C0,C0,C3,
      C3,C0,C0,C0,C0,C3,
       C3,C0,C0,C0,C3,
         C3,C3,C3,C3
};

#define SCROLL_LINES  (7)
#define SCROLL_COLUMNS (52)
#define SCROLL_MARGIN (7)

const CRGB led_scroll_pattern01[SCROLL_LINES][SCROLL_COLUMNS] = {
  // ↓↓↓ LED_Scroll_Pattern.xlsm で変換したコードをここに貼る ↓↓↓
	{		0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	},
	{	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0xFF0000	,	0xFF0000	,	0xFF0000	,	0xFF0000	,	0xFF0000	,	0x000000	,	0x548235	,	0x548235	,	0x548235	,	0x548235	,	0x548235	,	0x000000	,	0x000000	,	0xBF8F00	,	0xBF8F00	,	0xBF8F00	,	0xBF8F00	,	0xBF8F00	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000		},
	{		0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x305496	,	0x305496	,	0x305496	,	0x305496	,	0xFF0000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x548235	,	0x000000	,	0xBF8F00	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0xAEAAAA	,	0x000000	,	0xAEAAAA	,	0x000000	,	0xAEAAAA	,	0xAEAAAA	,	0xAEAAAA	,	0x000000	,	0xAEAAAA	,	0x000000	,	0x000000	,	0xAEAAAA	,	0x000000	,	0x000000	,	0x000000	,	0xAEAAAA	,	0xAEAAAA	,	0x000000	,	0xFF3399	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	},
	{	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0xFF0000	,	0xF2F2F2	,	0x305496	,	0xF2F2F2	,	0x305496	,	0x000000	,	0x548235	,	0x305496	,	0x000000	,	0x305496	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x305496	,	0x000000	,	0x305496	,	0xBF8F00	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0xAEAAAA	,	0x000000	,	0xAEAAAA	,	0xFF3399	,	0xFF3399	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000		},
	{		0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x305496	,	0xF2F2F2	,	0xF2F2F2	,	0x305496	,	0xFF0000	,	0x000000	,	0x000000	,	0x305496	,	0x305496	,	0x000000	,	0x548235	,	0x000000	,	0xBF8F00	,	0x000000	,	0x305496	,	0x305496	,	0x000000	,	0x000000	,	0xAEAAAA	,	0xAEAAAA	,	0xAEAAAA	,	0x000000	,	0xAEAAAA	,	0xAEAAAA	,	0x000000	,	0x000000	,	0xAEAAAA	,	0x000000	,	0x000000	,	0xAEAAAA	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0xFF3399	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	},
	{	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0xFF0000	,	0x305496	,	0x305496	,	0x305496	,	0x305496	,	0x000000	,	0x548235	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0xBF8F00	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0xAEAAAA	,	0x000000	,	0xAEAAAA	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000		},
	{		0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0xFF0000	,	0xFF0000	,	0xFF0000	,	0xFF0000	,	0xFF0000	,	0x000000	,	0x548235	,	0x548235	,	0x548235	,	0x548235	,	0x548235	,	0x000000	,	0xBF8F00	,	0xBF8F00	,	0xBF8F00	,	0xBF8F00	,	0xBF8F00	,	0x000000	,	0xAEAAAA	,	0x000000	,	0xAEAAAA	,	0x000000	,	0xAEAAAA	,	0xAEAAAA	,	0xAEAAAA	,	0x000000	,	0xAEAAAA	,	0xAEAAAA	,	0xAEAAAA	,	0xAEAAAA	,	0xAEAAAA	,	0xAEAAAA	,	0x000000	,	0xAEAAAA	,	0xAEAAAA	,	0x000000	,	0xFF3399	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	,	0x000000	},

  // ↑↑↑ LED_Scroll_Pattern.xlsm で変換したコードをここに貼る ↑↑↑
};


void hex_led_init(void){
  FastLED.addLeds<SK6812, LED_DATA_PIN, GRB>(leds, NUM_LEDS);  // GRB ordering is typical
  FastLED.setBrightness( LED_BRIGHTNESS );
}

void hex_led_ptn_set(const CRGB* ptn){
  memcpy(leds, ptn, NUM_LEDS * sizeof(CRGB));
  FastLED.show();
}

void hex_led_scroll_ptn_set(const CRGB ptn[][SCROLL_COLUMNS]){
  FastLED.setBrightness( LED_BRIGHTNESS );
  
  for(int frame=0; frame<(SCROLL_COLUMNS-SCROLL_MARGIN+1); frame++){

    memcpy(&leds[0], &ptn[0][frame + 1], sizeof(CRGB)*4);
    memcpy(&leds[4], &ptn[1][frame + 1], sizeof(CRGB)*5);
    memcpy(&leds[9], &ptn[2][frame], sizeof(CRGB)*6);
    memcpy(&leds[15], &ptn[3][frame], sizeof(CRGB)*7);
    memcpy(&leds[22], &ptn[4][frame], sizeof(CRGB)*6);
    memcpy(&leds[28], &ptn[5][frame + 1], sizeof(CRGB)*5);
    memcpy(&leds[33], &ptn[6][frame + 1], sizeof(CRGB)*4);

    FastLED.show();
    delay(200);

  }

}


void hex_led_ptn_off(void){
  hex_led_ptn_set(led_pattern00);
}

void hex_led_ptn_wake(void){
  FastLED.setBrightness( LED_BRIGHTNESS );
  hex_led_ptn_set(led_pattern01);
}


void hex_led_ptn_accept(void){
  FastLED.setBrightness( LED_BRIGHTNESS );
  for(int i=0; i<5; i++){
    // Turn the LED on, then pause
    hex_led_ptn_set(led_pattern01);
    delay(200);
    // Now turn the LED off, then pause
    hex_led_ptn_set(led_pattern02);
    delay(200);
  }
  hex_led_ptn_set(led_pattern00);
}


#define OMEGA   (M_PI * 2 / 6000)      //点滅の周期6秒
void hex_led_ptn_notification(void){
  unsigned int tick_ms;

  tick_ms = xTaskGetTickCount() * portTICK_RATE_MS;

  FastLED.setBrightness( LED_BRIGHTNESS * (sin(OMEGA * tick_ms) + 1.0) / 2.0);
  hex_led_ptn_set(led_pattern03);

}


void hex_led_ptn_boot(void){

  hex_led_scroll_ptn_set(led_scroll_pattern01);

}